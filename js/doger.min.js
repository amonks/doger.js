Doger={doger:function(e,t){var r=Doger.doge_image(),o=Doger.keywords_to_doge_text(t),n=Doger.make_doge_html(r,o);if(n.clone().appendTo(e),arguments.length>=3){var a=$("<div>").append(n.clone()).html();arguments[2].text(a)}return{image:r,doge_text:o}},keywords_to_doge_text:function(e){e=Doger.shuffle_array(e);for(var t=[],r=0;r<=e.length-1;r++)t.push(Doger.random_from_array(Doger.doge_words)+" "+e[r].toLowerCase());return t.push(Doger.random_from_array(Doger.doge_end_words)),t},make_doge_html:function(e,t){var r=$("<div class='doger'><img src='"+e.url+"'class='img-rounded' /></div>");if(r.find("img").css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}),r.css({"font-family":"'Comic Sans', 'Comic Sans MS', 'Marker Felt', cursive","font-weight":"bold","font-size":"20px",position:"relative",width:"100%",height:"0","padding-bottom":""+e.height/e.width*100+"%"}),t.length<=1)return r;for(var o=0;o<=t.length-1;o++){var n=$("<span class='dogetext'>"+t[o]+"</span>"),a=100*Math.random()*.75,i=o*(100/t.length),g=Doger.random_color(),d=Doger.random_color();n.css({position:"absolute",top:""+i+"%",left:""+a+"%","text-shadow":"1px 1px"+d,color:g}),r.append(n)}return r},make_doge_image:function(e,t){var r=$("<img src='"+e.url+"'class='img-rounded' />").get(0),o=$("<canvas width='"+e.width+"' height='"+e.height+"'></canvas>").get(0),n=o.getContext("2d");if(n.drawImage(r,0,0),t.length<=1)return o.toDataURL("image/png");n.font="bold 28px 'Comic Sans', 'Comic Sans MS', 'Marker Felt', cursive";for(var a=0;a<=t.length-1;a++){var i=Math.random()*e.width*.75,g=a*(e.height/t.length)+e.height/t.length/2;n.fillStyle=Doger.random_color(),n.fillText(t[a],i+2,g+2),n.fillStyle=Doger.random_color(),n.fillText(t[a],i,g)}var d=o.toDataURL("image/png"),l=Doger.make_url_from_data(d);return{dataURI:d,blobURI:l}},doge_image:function(){return doge_images=[{url:"http://doge.needsyourhelp.org/images/shiba-inu-puppies-pictures.jpg",width:922,height:922},{url:"http://doge.needsyourhelp.org/images/001.jpg",width:1023,height:1024},{url:"http://doge.needsyourhelp.org/images/Taisen_Shikaki_Inu.jpg",width:800,height:994},{url:"http://doge.needsyourhelp.org/images/running-shiba-inu-dog-photo.jpg",width:1440,height:934},{url:"http://doge.needsyourhelp.org/images/12_11_10-031.jpg",width:1600,height:1200},{url:"http://doge.needsyourhelp.org/images/shiba-inu-21.jpg",width:1e3,height:1e3},{url:"http://doge.needsyourhelp.org/images/Japanese_shiba_inu__shiba_dog__by_MogamiJ.jpg",width:1024,height:768},{url:"http://doge.needsyourhelp.org/images/1024px-Taka_Shiba.jpg",width:1024,height:768},{url:"http://doge.needsyourhelp.org/images/c09.jpg",width:1280,height:960}],Doger.random_from_array(doge_images)},keywords_from_url:function(e){for(var t="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20contentanalysis.analyze%20where%20url%3D%22"+escape(e)+"%22&diagnostics=true",r=$(Doger.http_get(t)),o=r.find("entity"),n=[],a=0;a<=o.length-1;a++)n.push($(o[a]).find("text").text());return n},keywords_from_text:function(e){for(var t="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20contentanalysis.analyze%20where%20text%3D%22"+encodeURI(e.replace(/[^a-zA-Z ]+/g,""))+"%22&diagnostics=true",r=$(Doger.http_get(t)),o=r.find("entity"),n=[],a=o.length-1;a>=0;a--)n.push($(o[a]).find("text").text());return n},bookmarklet:function(){Doger.load_script("http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js",function(){var e=Doger.get_selected_text(),t=Doger.keywords_from_text(e);if(t.length>0){var r="http://doge.needsyourhelp.org?"+btoa(t);window.location=r}else alert("no keywords found")})},get_selected_text:function(){var e="";return window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),e},get_query_string:function(){if(-1==window.location.href.indexOf("?"))return null;var e=window.location.href.slice(window.location.href.indexOf("?")+1);return e.length<=1?null:atob(e)},get_keywords_from_query_string:function(){var e=Doger.get_query_string();if(null!==e){var t=e.split(",");return t}return arguments.length>0?arguments[0]:null},check_for_url:function(e){var t=new RegExp("^(https?:\\/\\/)","i");return t.test(e)?!0:!1},http_get:function(e){if(0==Doger.check_for_url(e))return null;var t=null;return t=new XMLHttpRequest,t.open("GET",e,!1),t.send(null),t.responseText},sort_array_by_frequency:function(e){var t={};e.forEach(function(e){t[e]=0});var r=e.filter(function(e){return 1==++t[e]});return r.sort(function(e,r){return t[r]-t[e]})},random_from_array:function(e){return e[Math.floor(Math.random()*e.length)]},shuffle_array:function(e){for(var t,r,o=e.length;0!==o;)r=Math.floor(Math.random()*o),o-=1,t=e[o],e[o]=e[r],e[r]=t;return e},remove_stopwords_from_array:function(e){for(var t=e.length-1;t>=0;t--)e[t]=e[t].toLowerCase();var r=(Doger.union_arrays(e,Doger.stopwords),Doger.intersection_arrays(e,Doger.stopwords)),o=Doger.difference_arrays(e,r);return o},union_arrays:function(e,t){for(var r={},o=e.length-1;o>=0;--o)r[e[o]]=e[o];for(var o=t.length-1;o>=0;--o)r[t[o]]=t[o];var n=[];for(var a in r)r.hasOwnProperty(a)&&n.push(r[a]);return n},intersection_arrays:function(e,t){return e.filter(function(e){return-1!=t.indexOf(e)})},difference_arrays:function(e,t){return e.filter(function(e){return!(t.indexOf(e)>-1)})},random_color:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},load_script:function(e,t){var r=document.getElementsByTagName("head")[0],o=document.createElement("script");o.src=e;var n=!1;o.onload=o.onreadystatechange=function(){n||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n=!0,t(),o.onload=o.onreadystatechange=null,r.removeChild(o))},r.appendChild(o)},load_image:function(e,t){var r=new Image;r.onload=t,r.src=e},download_data_uri:function(e,t){var r=Doger.make_url_from_data(e),o=$('<a href="'+r+'" id="download" download="'+t+'" target="_blank"> </a>');$("body").append(o),$("#download").get(0).click()},make_url_from_data:function(e){var t=Doger.make_blob(e),r=URL.createObjectURL(t);return r},make_blob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var r=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length),n=new Uint8Array(o),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return new Blob([o],{type:r})},doge_words:["such","much","very","many","so","how"],doge_end_words:["wow","amaze","excite"],stopwords:["he","she","a","the","and","if","or","not","me","i"]};