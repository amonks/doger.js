Doger={doger:function(e,r){var t=Doger.doge_image(),o=Doger.keywords_to_doge_text(r),n=Doger.make_doge_html(t,o);if(n.clone().appendTo(e),arguments.length>=3){var a=$("<div>").append(n.clone()).html();arguments[2].text(a)}return{image:t,doge_text:o}},keywords_to_doge_text:function(e){e=Doger.shuffle_array(e);for(var r=[],t=0;t<=e.length-1;t++)r.push(Doger.random_from_array(Doger.doge_words)+" "+e[t].toLowerCase());return r.push(Doger.random_from_array(Doger.doge_end_words)),r},make_doge_html:function(e,r){var t=$("<div class='doger'><img src='"+e.url+"'class='img-rounded' /></div>");if(t.find("img").css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}),t.css({"font-family":"'Comic Sans', 'Comic Sans MS', 'Marker Felt', cursive","font-weight":"bold","font-size":"20px",position:"relative",width:"100%",height:"0","padding-bottom":""+e.height/e.width*100+"%"}),r.length<=1)return t;for(var o=0;o<=r.length-1;o++){var n=$("<span class='dogetext'>"+r[o]+"</span>"),a=100*Math.random()*.75,i=o*(100/r.length),g=Doger.random_color(),s=Doger.random_color();n.css({position:"absolute",top:""+i+"%",left:""+a+"%","text-shadow":"1px 1px"+s,color:g}),t.append(n)}return t},make_doge_image:function(e,r){var t=$("<img src='"+e.url+"'class='img-rounded' />").get(0),o=$("<canvas width='"+e.width+"' height='"+e.height+"'></canvas>").get(0),n=o.getContext("2d");if(n.drawImage(t,0,0),r.length<=1)return o.toDataURL("image/png");n.font="bold 28px 'Comic Sans', 'Comic Sans MS', 'Marker Felt', cursive";for(var a=0;a<=r.length-1;a++){var i=Math.random()*e.width*.75,g=a*(e.height/r.length)+e.height/r.length/2;n.fillStyle=Doger.random_color(),n.fillText(r[a],i+2,g+2),n.fillStyle=Doger.random_color(),n.fillText(r[a],i,g)}var s=o.toDataURL("image/png"),d=Doger.make_url_from_data(s);return{dataURI:s,blobURI:d}},doge_image:function(){return doge_images=[{url:"http://doge.needsyourhelp.org/images/shiba-inu-puppies-pictures.jpg",width:922,height:922},{url:"http://doge.needsyourhelp.org/images/001.jpg",width:1023,height:1024},{url:"http://doge.needsyourhelp.org/images/Taisen_Shikaki_Inu.jpg",width:800,height:994},{url:"http://doge.needsyourhelp.org/images/running-shiba-inu-dog-photo.jpg",width:1440,height:934},{url:"http://doge.needsyourhelp.org/images/12_11_10-031.jpg",width:1600,height:1200},{url:"http://doge.needsyourhelp.org/images/shiba-inu-21.jpg",width:1e3,height:1e3},{url:"http://doge.needsyourhelp.org/images/Japanese_shiba_inu__shiba_dog__by_MogamiJ.jpg",width:1024,height:768},{url:"http://doge.needsyourhelp.org/images/1024px-Taka_Shiba.jpg",width:1024,height:768},{url:"http://doge.needsyourhelp.org/images/c09.jpg",width:1280,height:960}],Doger.random_from_array(doge_images)},keywords_from_url:function(e){for(var r="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20contentanalysis.analyze%20where%20url%3D%22"+escape(e)+"%22&diagnostics=true",t=$(Doger.http_get(r)),o=t.find("entity"),n=[],a=0;a<=o.length-1;a++)n.push($(o[a]).find("text").text());return n},keywords_from_text:function(e){for(var r="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20contentanalysis.analyze%20where%20text%3D%22"+encodeURI(e.replace(/[^a-zA-Z ]+/g,""))+"%22&diagnostics=true",t=$(Doger.http_get(r)),o=t.find("entity"),n=[],a=o.length-1;a>=0;a--)n.push($(o[a]).find("text").text());if(void 0==n){var i=Doger.remove_stopwords_from_array(e.replace(/[^a-zA-Z\d\s:]/,"").split(" "),Doger.stopwords),g=Doger.sort_array_by_frequency(i).slice(0,4);n=n.concat(g),n=Doger.remove_stopwords_from_array(n,Doger.stopwords)}if(void 0!==n&&n.length<=2){var i=Doger.remove_stopwords_from_array(e.replace(/[^a-zA-Z\d\s:]/,"").split(" "),Doger.stopwords),g=Doger.sort_array_by_frequency(i).slice(0,4);n=n.concat(g),n=Doger.remove_stopwords_from_array(n,Doger.stopwords)}return n},bookmarklet:function(){Doger.load_script("http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js",function(){var e=Doger.get_selected_text(),r=Doger.keywords_from_text(e);if(r.length>0){var t="http://doge.needsyourhelp.org?"+btoa(r);window.location=t}else alert("no keywords found")})},get_selected_text:function(){var e="";return window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),e},get_query_string:function(){if(-1==window.location.href.indexOf("?"))return null;var e=window.location.href.slice(window.location.href.indexOf("?")+1);return e.length<=1?null:atob(e)},get_keywords_from_query_string:function(){var e=Doger.get_query_string();if(null!==e){var r=e.split(",");return r}return arguments.length>0?arguments[0]:null},check_for_url:function(e){var r=new RegExp("^(https?:\\/\\/)","i");return r.test(e)?!0:!1},http_get:function(e){if(0==Doger.check_for_url(e))return null;var r=null;return r=new XMLHttpRequest,r.open("GET",e,!1),r.send(null),r.responseText},sort_array_by_frequency:function(e){var r={};e.forEach(function(e){r[e]=0});var t=e.filter(function(e){return 1==++r[e]});return t.sort(function(e,t){return r[t]-r[e]})},random_from_array:function(e){return e[Math.floor(Math.random()*e.length)]},shuffle_array:function(e){for(var r,t,o=e.length;0!==o;)t=Math.floor(Math.random()*o),o-=1,r=e[o],e[o]=e[t],e[t]=r;return e},remove_stopwords_from_array:function(e,r){for(var t=e.length-1;t>=0;t--)e[t]=e[t].toLowerCase();var o=(Doger.union_arrays(e,r),Doger.intersection_arrays(e,r)),n=Doger.difference_arrays(e,o);return n},union_arrays:function(e,r){for(var t={},o=e.length-1;o>=0;--o)t[e[o]]=e[o];for(var o=r.length-1;o>=0;--o)t[r[o]]=r[o];var n=[];for(var a in t)t.hasOwnProperty(a)&&n.push(t[a]);return n},intersection_arrays:function(e,r){return e.filter(function(e){return-1!=r.indexOf(e)})},difference_arrays:function(e,r){return e.filter(function(e){return!(r.indexOf(e)>-1)})},random_color:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},load_script:function(e,r){var t=document.getElementsByTagName("head")[0],o=document.createElement("script");o.src=e;var n=!1;o.onload=o.onreadystatechange=function(){n||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n=!0,r(),o.onload=o.onreadystatechange=null,t.removeChild(o))},t.appendChild(o)},load_image:function(e,r){var t=new Image;t.onload=r,t.src=e},download_data_uri:function(e,r){var t=Doger.make_url_from_data(e),o=$('<a href="'+t+'" id="download" download="'+r+'" target="_blank"> </a>');$("body").append(o),$("#download").get(0).click()},make_url_from_data:function(e){var r=Doger.make_blob(e),t=URL.createObjectURL(r);return t},make_blob:function(e){var r;r=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var t=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(r.length),n=new Uint8Array(o),a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return new Blob([o],{type:t})},doge_words:["such","much","very","many","so","how"],doge_end_words:["wow","amaze","excite"],stopwords:["of","he","she","him","her","it","this","is","its","a","the","and","if","or","not","me","i","and","an","are","as","at","be","by","for","from","has","in","of","on","that","to","was","were","with","would","we","them","who","whom"]};